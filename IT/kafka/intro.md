Зачем кафка?

- отправка сообщений сразу многим получателям
- нет потери сообщений если получатель недоступен
- добавления получателя не требует доработки отправителя

В случае, если используется REST, сообщения отправляются напрямую.

С кафкой сообщения сначала публикуются в кафка топик и уже из топика другие 
сервисы считывают сообщения.

Тот кто публикует сообщения называется Producer или Publisher, а те кто 
читают сообщения называется Consumer или Subscriber.

Producer не знает о Consumer, а Consumer про Producer.

Это позволяется добавлять Consumer при этом не делать изменения в Producer.

Это называется Event Driver Architecture - события публикуются, что 
явлляется триггером для дальнейших действий.

 - Асинхронное взаимодействие
 - Слабые связи
 - Гибкость изменений
 - Легкое масштабирование
 - Consumer пожет обработать сообзения после восстановления
 - Producer не ждет отбработки, не знает про то, кто обрабатывает

Kafka Broker - сервер, который получает сообщение от producer и сохраняте 
сообщение на диске, после чего передает его в consumer. 

Каждый broker отвечает за управление одним или несколькими topic, которые 
разделены на partition для распределения даннных. Каждый новый event 
сохраняется в partition.
Broker выполняют важную роль в обеспечении отказоустойчивости и 
масштабируемости в Kafka.
```

                               Kafka Cluster
+—————————————————————————————————————————————————————————————————————————+
|                                                                         |
|                                Broker                                   |
|   +—————————————————————————————————————————————————————————————————+   |
|   |                                                                 |   |
|   |             Topic                            Topic              |   |
|   |   +—————————————————————————+     +—————————————————————————+   |   |
|   |   |                         |     |                         |   |   |
|   |   |        Partition        |     |       Partition         |   |   |
|   |   |    +——————————————+     |     |    +——————————————+     |   |   |
|   |   |    |    |    |    |     |     |    |    |    |    |     |   |   |
|   |   |    |————|————|————|     |     |    |————|————|————|     |   |   |
|   |   |    |    |    |    |     |     |    |    |    |    |     |   |   |
|   |   |    |————|————|————|     |     |    |————|————|————|     |   |   |
|   |   |    |    |    |    |     |     |    |    |    |    |     |   |   |
|   |   |    +——————————————+     |     |    +——————————————+     |   |   |
|   |   |                         |     |                         |   |   |
|   |   +—————————————————————————+     +—————————————————————————+   |   |
|   |                                                                 |   |
|   +—————————————————————————————————————————————————————————————————+   |
|                                                                         |
+—————————————————————————————————————————————————————————————————————————+

```



Kafka cluster - несколько broker синхронизированных между собой.

Kafka event - название состоит из названия сущности над которой происходит 
действие + название действия + постфикс event.

Topic - к нему подключаются consumer и читают сообщения. Состоит из 
partition, event из partition читаются по порядку.

Offset - partition index.

Event добавляется в конец partition
Event нельзя изменить или удалить.

По умолчания topic настроен на хранение events в течении 7 дней, но можно 
изменить.
Даже после прочтения event он продолжает хранится еще 7 дней.

Изначально event распределяются между partitions, а consumer читает 
event паралельно, то есть не гарантируется очередность чтения из partition.

Если отправлять event с одинаковым key то они будут попадать в одну partition.

Message состоит из
- Key(message id)
- Event (message value)
- Timestamp (creation time)
- Headers (optional, ex: auth header)